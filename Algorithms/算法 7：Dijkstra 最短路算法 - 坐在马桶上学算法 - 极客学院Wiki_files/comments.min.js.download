!function(t,e,a,n){function i(t,e,n){var i=a('<ul class="pages"></ul>');i.append(s("首页",t,e,n)).append(s("上一页",t,e,n));var r=1,c=8,l="<li class='thpoint'>...</li>";t>4&&(r=t-3,c=t+3),c>e&&(r=e-8,c=e,l=""),1>r&&(r=1);for(var d=r;c>=d;d++){var p=a('<li class="page-number">'+d+"</li>");d==t?p.addClass("pgCurrent"):p.click(function(){n(this.firstChild.data)}),p.appendTo(i)}i.append(l).append(s("下一页",t,e,n)).append(s("末页",t,e,n)),i.append("<li class='thpoint pagetotal' style='margin-top:3px;'>共 "+e+" 页</li>");var u=a("<li class='thpoint pagenow'>当前<input type='text' value='"+t+"'maxlength='6' id='gotoval' style='width:20px; height:16px;margin-top:-3px;padding-top:2px;padding-left:10px;'/>页</li>");return i.append(u),i.append(o("确定",e,n)),i}function o(t,e,n){var i=a('<li class="pgNext go">'+t+"</li>");return i.click(function(){var t=a("#gotoval").val(),i=parseInt(t),o=/^[1-9]*[1-9][0-9]*$/;return o.exec(i)?i>e?void alert("您输入的页数超过总页数"+e):void n(i):(alert("请输入非零的正整数！"),!1)}),i}function s(t,e,n,i){var o=a('<li class="pgNext">'+t+"</li>"),s=1;switch(t){case"首页":s=1;break;case"上一页":s=e-1;break;case"下一页":s=e+1;break;case"末页":s=n}return"首页"==t||"上一页"==t?1>=e?o.addClass("pgEmpty"):o.click(function(){i(s)}):e>=n?o.addClass("pgEmpty"):o.click(function(){i(s)}),o}if("error"==n)return void alert("JKcomments没有定义");if(void 0==n.model)return alert("model未定义"),!1;if(void 0==n.item_id)return alert("item_id"),!1;var r=document.location.host.split("."),c=r.length-1,l=r.length-2,d="."+r[l]+"."+r[c],p="https:"==document.location.protocol?"https://":"http://",u=("https:"==document.location.protocol?"wss://":"ws://",function(){this.allfile=[[p+"sw1"+d+"/home/css/comments.min.css","css"]],this.config={JKURL:p+"ws"+d+"/comment/lists",JKDELE:p+"ws"+d+"/comment/delete",JKADD:p+"ws"+d+"/comment/add",JKUSERINFOR:p+"ws"+d+"/user/current",JKLIKE:p+"ws"+d+"/comment/like",JKCOLLECT:p+"ws"+d+"/comment/collect",JKREPORT:p+"ws"+d+"/comment/report",JKMINTXT:"说点什么吧...不少于10个字符",JKMAXTXT:"不能超过500个字符",IMGEROR:"请输入正确的图片地址",ERROR:"网络错误请刷新重试！"}});u.prototype={innerScriptOrStyle:function(t,a){if(void 0==a||"script"==a){var n=e.createElement("script"),i=e.head||e.getElementsByTagName("head")[0]||e.documentElement;n.type="text/javascript",n.src=t,n.async="async",n.charset="utf-8"}else if("css"==a||"style"==a){var n=e.createElement("link"),i=e.head||e.getElementsByTagName("head")[0]||e.documentElement;n.type="text/css",n.rel="stylesheet",n.href=t}i.insertBefore(n,i.firstChild)},addLink:function(){for(var t=this,e=t.allfile,a=0;a<e.length;a++)t.innerScriptOrStyle(e[a][0],e[a][1])},_lockey:!0,elementBind:function(){var t=this;a("#txt-btn").unbind("click"),a("#txt-remove").unbind("click"),a("#txt-reply").unbind("click"),a("#jkcomments").keyup(function(e){if(e.ctrlKey&&13==e.keyCode){if(0==t._lockey)return!1;t._lockey=!1,a("#editor").blur(),a("#txt-btn").click()}}),a("#txt-btn").bind("click",{self:this},t.addList),a("#editor").on("keyup",function(){var t=a(this).val().length;t>500&&(a(this).val(a(this).val().substring(0,500)),t=500);var e=t;a("#wordsize em").text(e)}),a(".jkaddpic").on("click",function(){var t='<img src="图片链接地址">',e=a("#editor").val(),n=e+t;a("#editor").val(n)}),a(".txt-jubao>dl>dd").on("click",{self:t},t.jubao),a(".txt-shoucang").on("click",{self:t},t.shoucang),a(".txt-zan").on("click",{self:t},t.clickZan),a(".txt-remove").bind("click",{self:t},t.deleList),a(".txt-reply").bind("click",{self:t},t.txtReply)},jkAjax:function(t){function e(t){if(200==t.code){var e="<ul></ul>";a("#jkcomments").empty(),a("#jkcomments").prepend(e),a("#jkcomments").append('<div id="pager"></div>');for(var i=t.data.list,s=0;s<i.length;s++){i[s].time=r.creatTime(Date.parse(i[s].created_at.replace(/[-]/g,"/"))/1e3);var c=r.creatEle(i[s]);a("#jkcomments>ul").append(c)}if(200==n.login){var l={pic:n.pic_url,uname:n.uname,domain:n.domain};r.editor(l)}else r.theLogin();var d=function(e){a("#pager").pager({pagenumber:e,pagecount:t.data.total_pages,buttonClickCallback:d}),r.jkAjax(e)};if(t.data.total_pages>1&&a("#pager").pager({pagenumber:t.data.page,pagecount:t.data.total_pages,buttonClickCallback:d}),r.elementBind(),void 0!=o){var p=a("#jkcomments").find("#"+o).offset().top,u=a(window).innerHeight();p-u>0&&a("html,body").animate({scrollTop:p},500)}}else alert(t.msg)}function i(){alert(self.config.ERROR)}var o;void 0==t&&(o=document.location.href.split("#")[1]);var s={model:n.model,item_id:n.item_id,parent_id:n.parent_id||"",page:t||1,perPage:n.perPage||5,target:o||""},r=this;r.ajaxFun(r.config.JKURL,"get",s,"jsonp",e,i)},theLogin:function(){var t='<div class="jkxy-subask-nologin">';t+='只有登录了才能参与评论，快<a href="'+p+'passport.jikexueyuan.com/sso/login">登录</a>',t+='！如果你还没有账号你可以<a href="'+p+'passport.jikexueyuan.com/sso/reg_phone" >注册</a>一个账号。</div>',a("#jkcomments").append(t)},creatEle:function(t){var e="<li class='cf'>";return 0==t.is_delete&&(e+="<a href="+t.domain+" target='_blank'>",e+="<img src="+t.pic_url+" class='user-icon'/></a>",e+="<div class='txt'>",e+="<div class='txt-title'>",e+="<a href="+t.domain+" class='txt-name' target='_blank'>",e+=t.uname+"</a>",e+="<span class='txt-floor' id='"+t.floor+"'>#"+t.floor+"</span></div>"),0==t.is_delete?(e+=void 0!=t.reply_uname&&""!=t.reply_uname?"<div class='txt-content'><pre><div class='replybox'>#"+t.reply_floor+"@"+t.reply_uname+"</div>"+t.body+"</pre></div>":"<div class='txt-content'><pre>"+t.body+"</pre></div>",e+="<div class='txt-oter'>",e+="<span class='txt-time'>"+t.time+"</span>",e+=1==t.is_like?"<span class='txt-zan liked' zan_id="+t.id+" >"+t.good_num+"</span>":"<span class='txt-zan' zan_id="+t.id+">"+t.good_num+"</span>",e+="<span class='txt-reply' reply_id="+t.id+">回复</span>",0==t.is_report?(e+="<span class='txt-jubao' jubaoid="+t.id+">",e+="<dl><dd>广告位等垃圾信息</dd><dd>不友善内容</dd><dd>违反法律法规的内容</dd><dd>不宜公开讨论的政治内容</dd><dd>其他</dd></dl>",e+="</span>"):e+=1==t.is_report?"<span class='txt-jubao jubao' jubaoid="+t.id+"></span>":"<span class='txt-jubao' jubaoid="+t.id+"></span>",e+=1==t.is_collect?"<span class='txt-shoucang shoucang' scid="+t.id+"></span>":"<span class='txt-shoucang' scid="+t.id+"></span>",1==t.is_self&&(e+="<span class='txt-remove' id="+t.id+"></span>"),e+="</div>"):e+="<div class='txt-content'><p style='font-size:12px; color:#999;text-align: center; padding:20px 0px'>被带到火星去了</p></div>",e+="</div>"},editor:function(t){var e='<div class="editor-layout cf"><a href='+t.domain+' target="_blank"><img src='+t.pic+" alt="+t.uname+' class="user-icon" /></a>';e+='<div class="textbox">',e+="<div id='talkfloor'></div>",e+='<textarea id="editor" placeholder="说点什么吧…不少于10个字符"></textarea>',e+='<div class="toolbox"><span class="emotion"><img src="'+p+"sw1"+d+'/home/images/arclist/one.png"/></span>',e+='<span class="jkaddpic"></span>',e+='<button class="greenbtn" id="txt-btn">提交回复</button><span id="wordsize"><em>0</em>/500</span></div></div></div>',a("#jkcomments").append(e),a(".emotion").qqFace({assign:"saytext",path:"face/"})},gotoSubask:function(){var t=a("#jkcomments").find(".jkxy-subask-nologin").offset().top,e=a(window).innerHeight();t-e>0&&a("html,body").animate({scrollTop:t},500)},txtReply:function(t){if(""==n.uname)t.data.self.gotoSubask();else{t.data.self.keyFunc();var e=a("#jkcomments").find(".editor-layout").offset().top,i=a(window).innerHeight(),o=a(this).parents("li").find(".txt-floor").text(),s=a(this).parents("li").find(".txt-name").text(),r=o+"@"+s;n.reply_id=a(this).attr("reply_id"),a("#jkcomments>.editor-layout>.textbox").find("#talkfloor").html(r).show(),a("#jkcomments>.editor-layout>.textbox").find("#editor").css("paddingTop","30px"),e-i>0&&a("html,body").animate({scrollTop:e},500,function(){a("#jkcomments>.editor-layout>.textbox").find("#editor").focus()})}},keyFunc:function(){a(window).keydown(function(t){switch(t.keyCode){case 8:var e=a("#jkcomments>.editor-layout>.textbox").find("#editor");e.val().length<=0&&(a("#jkcomments>.editor-layout>.textbox").find("#talkfloor").html("").hide(),n.reply_id="",e.css("paddingTop","10px"))}})},addList:function(t){function e(){s._lockey=!0,c.attr("disabled",!1)}function i(t){switch(t.code){case 200:alert("评论成功!"),s.jkAjax();break;default:alert(t.msg)}}function o(){alert(s.config.ERROR)}var s=t.data.self,r=a("#jkcomments>.editor-layout>.textbox").find("#editor").val().substr(0,500);if(r.indexOf("图片链接地址")>=0)return void alert(s.config.IMGEROR);if(r.length<10)return void alert(s.config.JKMINTXT);if(r.length>500)return void alert(s.config.JKMAXTXT);a(this).attr("disabled",!0);var c=a(this),l={model:n.model,item_id:n.item_id,parent_id:n.parent_id||"",reply_id:n.reply_id||"",body:r};s.ajaxFun(s.config.JKADD,"get",l,"jsonp",i,o,e)},jubao:function(t){function e(t){switch(t.code){case 200:s.parents(".txt-jubao").addClass("jubao"),s.parent("dl").remove();break;default:alert(t.msg)}}function i(){alert(o.config.ERROR)}if(""==n.uname)return t.data.self.gotoSubask(),!1;var o=t.data.self,s=a(this),r=s.parents(".txt-jubao").attr("jubaoid"),c=s.text(),l={topic_id:r,content:c};o.ajaxFun(o.config.JKREPORT,"get",l,"jsonp",e,i)},shoucang:function(t){function e(t){switch(t.code){case 200:0==o?(r.addClass("shoucang"),r.append("<span id='scone'>收藏</span>"),a("#scone").animate({top:"-30px",opacity:.3},1e3,function(){a("#scone").remove()})):1==o&&(r.removeClass("shoucang"),r.append("<span id='scone'>取消</span>"),a("#scone").animate({top:"-30px",opacity:.3},1e3,function(){a("#scone").remove()}));break;default:alert(t.msg)}}function i(){alert(s.config.ERROR)}if(""==n.uname)return t.data.self.gotoSubask(),!1;var o,s=t.data.self,r=a(this),c=r.attr("scid");o=r.hasClass("shoucang")?1:0;var l={topic_id:c,collect_type:o};s.ajaxFun(s.config.JKCOLLECT,"get",l,"jsonp",e,i)},clickZan:function(t){function e(t){switch(t.code){case 200:var e=r.text();0==o?(e++,r.addClass("liked"),r.html(e),r.append("<span id='zanone'>+1</span>"),a("#zanone").animate({top:"-30px",opacity:0,fontSize:"14px"},1e3,function(){a("#zanone").remove()})):1==o&&(e--,0>e&&(e=0),r.removeClass("liked"),r.html(e),r.append("<span id='zanone'>-1</span>"),a("#zanone").animate({top:"-30px",opacity:.3},1e3,function(){a("#zanone").remove()}));break;default:alert(t.msg)}}function i(){alert(s.config.ERROR)}if(""==n.uname)return t.data.self.gotoSubask(),!1;var o,s=t.data.self,r=a(this),c=r.attr("zan_id");o=r.hasClass("liked")?1:0;var l={topic_id:c,like_type:o};s.ajaxFun(s.config.JKLIKE,"get",l,"jsonp",e,i)},deleList:function(t){function e(t){switch(t.code){case 200:s.parents("li").remove();var e=a("#jkcomments>ul>li").length;1==e&&o.jkAjax();break;default:alert(t.msg)}}function i(){alert(o.config.ERROR)}if(""==n.uname)return!1;if(!confirm("确定要删除评论吗？"))return!1;var o=t.data.self,s=a(this),r=s.attr("id"),c={id:r};o.ajaxFun(o.config.JKDELE,"get",c,"jsonp",e,i)},getUserInfor:function(){function t(t){(200==t.code||10101==t.code)&&(n.login=t.code,n.uname=t.data.uname||"",n.pic_url=t.data.pic||"",n.domain=t.data.domain||"",a.jkAjax())}function e(){alert(a.config.ERROR)}var a=this;this.ajaxFun(a.config.JKUSERINFOR,"get",{},"jsonp",t,e)},ajaxFun:function(t,e,n,i,o,s,r){a.ajax({type:e,url:t,data:n,dataType:i,success:o,complete:r,error:s,async:!0})},creatTime:function(t){var e,a,n,i,o=parseInt((new Date).getTime()/1e3);if(i=o-t,n=parseInt(i/86400),a=parseInt(i/3600),e=parseInt(i/60),n>0&&4>n)return n+"天前";if(0>=n&&a>0)return a+"小时前";if(0>=a&&e>0)return e+"分钟前";if(0>=e)return"刚刚";if(n>=4){var s=new Date(1e3*t),r=s.getMonth()+1;return s.getFullYear()+"年"+r+"月"+s.getDate()+"日"}}};var f=new u;f.getUserInfor(),f.addLink(),a.fn.pager=function(t){a.extend({},a.fn.pager.defaults,t);return this.each(function(){a(this).empty().append(i(parseInt(t.pagenumber),parseInt(t.pagecount),t.buttonClickCallback)),a(".pages li").mouseover(function(){document.body.style.cursor="pointer"}).mouseout(function(){document.body.style.cursor="auto"})})},a.fn.pager.defaults={pagenumber:1,pagecount:1}}(window,document,jQuery,function(){return"undefined"!=typeof JKcomments?JKcomments:"error"}());